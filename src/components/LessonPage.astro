---
// Reusable lesson page component
import Layout from '../layouts/Layout.astro';
import LessonScreen from './LessonScreen.astro';
import LessonNavigation from './LessonNavigation.astro';

export interface LessonPageProps {
  lessonNumber: number;
  totalLessons: number;
  title: string;
  description: string;
  learningPoints: string[];
  content: {
    topic: string;
    explanation: string;
    examples?: string[];
  }[];
  quiz: {
    question: string;
    options: string[];
    correctAnswer: number;
    explanation?: string;
  }[];
  // Navigation props
  previousLesson?: {
    title: string;
    url: string;
  };
  nextLesson?: {
    title: string;
    url: string;
  };
  // Additional customization
  welcomeEmoji?: string;
  pageTitle?: string;
  metaDescription?: string;
}

const { 
  lessonNumber,
  totalLessons,
  title,
  description,
  learningPoints,
  content,
  quiz,
  previousLesson,
  nextLesson,
  welcomeEmoji = "üìö",
  pageTitle,
  metaDescription
} = Astro.props;

// Generate default page title and meta description if not provided
const defaultPageTitle = pageTitle || `English Learning - ${title}`;
const defaultMetaDescription = metaDescription || `Aprende ${title.toLowerCase()} con lecciones interactivas y quizzes`;
---

<Layout title={defaultPageTitle} description={defaultMetaDescription}>
  <!-- Welcome Section -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
      Welcome to Lesson {lessonNumber}! {welcomeEmoji}
    </h1>
    <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
      {description}
    </p>
  </div>

  <!-- Enhanced Navigation -->
  <LessonNavigation 
    lessonNumber={lessonNumber}
    totalLessons={totalLessons}
    previousLesson={previousLesson}
    nextLesson={nextLesson}
  />

  <!-- Lesson Component -->
  <LessonScreen 
    title={title}
    description={description}
    learningPoints={learningPoints}
    content={content}
    quiz={quiz}
  />

  <!-- Next Steps -->
  <div class="mt-12 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/30 dark:to-blue-900/30 rounded-lg p-8 border border-green-200 dark:border-green-700">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 text-center">
      üéâ {lessonNumber === 1 ? 'Great Job!' : 'Excellent Work!'} What's Next?
    </h2>
    <p class="text-gray-700 dark:text-gray-300 text-center mb-6">
      ¬°Has completado la lecci√≥n {lessonNumber}! {lessonNumber < totalLessons ? 'Contin√∫a tu viaje de aprendizaje con m√°s temas.' : '¬°Has terminado el curso completo!'}
    </p>
    
    <div class="grid md:grid-cols-3 gap-4">
      <!-- Next Lesson Card -->
      <div class={`relative text-center p-6 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 ${nextLesson ? 'hover:shadow-lg hover:scale-105 transition-all duration-300 cursor-pointer group' : ''}`}>
        <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">
          {nextLesson ? 'üìö' : 'üèÜ'}
        </div>
        <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400">
          {nextLesson ? 'Pr√≥xima Lecci√≥n' : 'Curso Completado'}
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
          {nextLesson ? nextLesson.title : '¬°Felicitaciones por completar el curso!'}
        </p>
        {nextLesson && (
          <>
            <div class="bg-blue-600 text-white text-xs font-semibold py-2 px-4 rounded-full group-hover:bg-blue-700 transition-colors">
              Continuar ‚Üí
            </div>
            <a href={nextLesson.url} class="absolute inset-0 rounded-lg" aria-label={`Go to ${nextLesson.title}`}></a>
          </>
        )}
        {!nextLesson && (
          <div class="bg-green-600 text-white text-xs font-semibold py-2 px-4 rounded-full">
            ¬°Completado! ‚úì
          </div>
        )}
      </div>
      
      <!-- Previous Lesson Card -->
      <div class={`relative text-center p-6 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 ${previousLesson ? 'hover:shadow-lg hover:scale-105 transition-all duration-300 cursor-pointer group' : 'opacity-50'}`}>
        <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">
          {previousLesson ? 'üìñ' : 'üèÅ'}
        </div>
        <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2 group-hover:text-green-600 dark:group-hover:text-green-400">
          {previousLesson ? 'Lecci√≥n Anterior' : 'Primera Lecci√≥n'}
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
          {previousLesson ? previousLesson.title : 'Est√°s en la primera lecci√≥n'}
        </p>
        {previousLesson && (
          <>
            <div class="bg-green-600 text-white text-xs font-semibold py-2 px-4 rounded-full group-hover:bg-green-700 transition-colors">
              ‚Üê Revisar
            </div>
            <a href={previousLesson.url} class="absolute inset-0 rounded-lg" aria-label={`Go back to ${previousLesson.title}`}></a>
          </>
        )}
      </div>
      
      <!-- Course Overview Card -->
      <div class="relative text-center p-6 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:shadow-lg hover:scale-105 transition-all duration-300 cursor-pointer group">
        <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üó∫Ô∏è</div>
        <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2 group-hover:text-purple-600 dark:group-hover:text-purple-400">Todas las Lecciones</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Ver el curso completo</p>
        <div class="bg-purple-600 text-white text-xs font-semibold py-2 px-4 rounded-full group-hover:bg-purple-700 transition-colors">
          Ver Curso
        </div>
        <a href="/" class="absolute inset-0 rounded-lg" aria-label="Go to course overview"></a>
      </div>
    </div>

    <!-- Quick Navigation Footer -->
    {(previousLesson || nextLesson) && (
      <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-between items-center">
          {previousLesson ? (
            <a 
              href={previousLesson.url}
              class="flex items-center text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 font-medium transition-colors"
            >
              <span class="mr-2">‚Üê</span>
              <span>Lecci√≥n {lessonNumber - 1}</span>
            </a>
          ) : (
            <div class="text-gray-400">
              <span>‚Üê Primera lecci√≥n</span>
            </div>
          )}
          
          {nextLesson ? (
            <a 
              href={nextLesson.url}
              class="flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium transition-colors"
            >
              <span>Lecci√≥n {lessonNumber + 1}</span>
              <span class="ml-2">‚Üí</span>
            </a>
          ) : (
            <div class="text-gray-400">
              <span>√öltima lecci√≥n ‚Üí</span>
            </div>
          )}
        </div>
      </div>
    )}
  </div>
</Layout>

<style>
  .relative {
    position: relative;
  }
  
  .absolute {
    position: absolute;
  }
  
  .inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>
