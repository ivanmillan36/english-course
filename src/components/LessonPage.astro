---
// Reusable lesson page component
import Layout from '../layouts/Layout.astro';
import LessonScreen from './LessonScreen.astro';
import LessonNavigation from './LessonNavigation.astro';
import type { ItemType } from '../data/lessons';

export interface LessonPageProps {
  lessonNumber: number;
  totalLessons: number;
  title: string;
  description: string;
  learningPoints: string[];
  content: {
    topic: string;
    explanation: string;
    examples?: ItemType[];
  }[];
  quiz: {
    question: string;
    options: string[];
    correctAnswer: number;
    explanation?: string;
  }[];
  // Navigation props
  previousLesson?: {
    title: string;
    url: string;
  };
  nextLesson?: {
    title: string;
    url: string;
  };
  // Additional customization
  welcomeEmoji?: string;
  pageTitle?: string;
  metaDescription?: string;
}

const { 
  lessonNumber,
  totalLessons,
  title,
  description,
  learningPoints,
  content,
  quiz,
  previousLesson,
  nextLesson,
  welcomeEmoji = "üìö",
  pageTitle,
  metaDescription
} = Astro.props;

// Generate default page title and meta description if not provided
const defaultPageTitle = pageTitle || `English Learning - ${title}`;
const defaultMetaDescription = metaDescription || `Aprende ${title.toLowerCase()} con lecciones interactivas y quizzes`;
---

<Layout title={defaultPageTitle} description={defaultMetaDescription}>
  <!-- Welcome Section -->
  <div class="text-center mb-10 animate-fade-in">
    <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-600 mb-6 shadow-xl">
      <span class="text-4xl">{welcomeEmoji}</span>
    </div>
    <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 dark:from-indigo-400 dark:via-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
      Welcome to Lesson {lessonNumber}!
    </h1>
  </div>

  <!-- Enhanced Navigation -->
  <LessonNavigation 
    lessonNumber={lessonNumber}
    totalLessons={totalLessons}
    previousLesson={previousLesson}
    nextLesson={nextLesson}
  />

  <!-- Lesson Component -->
  <LessonScreen 
    title={title}
    description={description}
    learningPoints={learningPoints}
    content={content}
    quiz={quiz}
  />

  <!-- Next Steps -->
  <div class="mt-12 bg-green-50 dark:bg-green-900/20 rounded-2xl p-8 md:p-10 border border-green-200 dark:border-green-800 shadow-modern-xl animate-scale-in">
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-green-400 to-emerald-600 mb-4 shadow-xl">
        <span class="text-3xl">üéâ</span>
      </div>
      <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-3">
        {lessonNumber === 1 ? 'Great Job!' : 'Excellent Work!'} What's Next?
      </h2>
      <p class="text-gray-700 dark:text-gray-300 text-center text-base md:text-lg">
        ¬°Has completado la lecci√≥n {lessonNumber}! {lessonNumber < totalLessons ? 'Contin√∫a tu viaje de aprendizaje con m√°s temas.' : '¬°Has terminado el curso completo!'}
      </p>
    </div>
    
    <div class="grid md:grid-cols-3 gap-4 md:gap-6">
      <!-- Next Lesson Card -->
      <div class={`relative text-center p-6 md:p-8 bg-white dark:bg-gray-800 rounded-2xl border-2 ${nextLesson ? 'border-blue-200 dark:border-blue-800 hover:border-indigo-400 dark:hover:border-indigo-600 hover:shadow-modern-xl hover:scale-105 transition-all duration-300 cursor-pointer group' : 'border-gray-200 dark:border-gray-700'} shadow-modern-lg`}>
        <div class="text-4xl md:text-5xl mb-4 group-hover:scale-110 transition-transform duration-300">
          {nextLesson ? 'üìö' : 'üèÜ'}
        </div>
        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
          {nextLesson ? 'Pr√≥xima Lecci√≥n' : 'Curso Completado'}
        </h3>
        <p class="text-sm md:text-base text-gray-600 dark:text-gray-400 mb-4">
          {nextLesson ? nextLesson.title : '¬°Felicitaciones por completar el curso!'}
        </p>
        {nextLesson && (
          <>
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-bold py-3 px-6 rounded-xl group-hover:from-indigo-700 group-hover:to-purple-700 transition-all duration-300 shadow-modern">
              Continuar ‚Üí
            </div>
            <a href={nextLesson.url} class="absolute inset-0 rounded-2xl" aria-label={`Go to ${nextLesson.title}`}></a>
          </>
        )}
        {!nextLesson && (
          <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white text-sm font-bold py-3 px-6 rounded-xl shadow-modern">
            ¬°Completado! ‚úì
          </div>
        )}
      </div>
      
      <!-- Previous Lesson Card -->
      <div class={`relative text-center p-6 md:p-8 bg-white dark:bg-gray-800 rounded-2xl border-2 ${previousLesson ? 'border-green-200 dark:border-green-800 hover:border-emerald-400 dark:hover:border-emerald-600 hover:shadow-modern-xl hover:scale-105 transition-all duration-300 cursor-pointer group' : 'border-gray-200 dark:border-gray-700 opacity-50'} shadow-modern-lg`}>
        <div class="text-4xl md:text-5xl mb-4 group-hover:scale-110 transition-transform duration-300">
          {previousLesson ? 'üìñ' : 'üèÅ'}
        </div>
        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-2 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors">
          {previousLesson ? 'Lecci√≥n Anterior' : 'Primera Lecci√≥n'}
        </h3>
        <p class="text-sm md:text-base text-gray-600 dark:text-gray-400 mb-4">
          {previousLesson ? previousLesson.title : 'Est√°s en la primera lecci√≥n'}
        </p>
        {previousLesson && (
          <>
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white text-sm font-bold py-3 px-6 rounded-xl group-hover:from-green-600 group-hover:to-emerald-700 transition-all duration-300 shadow-modern">
              ‚Üê Revisar
            </div>
            <a href={previousLesson.url} class="absolute inset-0 rounded-2xl" aria-label={`Go back to ${previousLesson.title}`}></a>
          </>
        )}
      </div>
      
      <!-- Course Overview Card -->
      <div class="relative text-center p-6 md:p-8 bg-white dark:bg-gray-800 rounded-2xl border-2 border-purple-200 dark:border-purple-800 hover:border-purple-400 dark:hover:border-purple-600 hover:shadow-modern-xl hover:scale-105 transition-all duration-300 cursor-pointer group shadow-modern-lg">
        <div class="text-4xl md:text-5xl mb-4 group-hover:scale-110 transition-transform duration-300">üó∫Ô∏è</div>
        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-2 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">Todas las Lecciones</h3>
        <p class="text-sm md:text-base text-gray-600 dark:text-gray-400 mb-4">Ver el curso completo</p>
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white text-sm font-bold py-3 px-6 rounded-xl group-hover:from-purple-700 group-hover:to-pink-700 transition-all duration-300 shadow-modern">
          Ver Curso
        </div>
        <a href="/" class="absolute inset-0 rounded-2xl" aria-label="Go to course overview"></a>
      </div>
    </div>

    <!-- Quick Navigation Footer -->
    {(previousLesson || nextLesson) && (
      <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-between items-center">
          {previousLesson ? (
            <a 
              href={previousLesson.url}
              class="flex items-center text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 font-medium transition-colors"
            >
              <span class="mr-2">‚Üê</span>
              <span>Lecci√≥n {lessonNumber - 1}</span>
            </a>
          ) : (
            <div class="text-gray-400">
              <span>‚Üê Primera lecci√≥n</span>
            </div>
          )}
          
          {nextLesson ? (
            <a 
              href={nextLesson.url}
              class="flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium transition-colors"
            >
              <span>Lecci√≥n {lessonNumber + 1}</span>
              <span class="ml-2">‚Üí</span>
            </a>
          ) : (
            <div class="text-gray-400">
              <span>√öltima lecci√≥n ‚Üí</span>
            </div>
          )}
        </div>
      </div>
    )}
  </div>
</Layout>

<style>
  .relative {
    position: relative;
  }
  
  .absolute {
    position: absolute;
  }
  
  .inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>
